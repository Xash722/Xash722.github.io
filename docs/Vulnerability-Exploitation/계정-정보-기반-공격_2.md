---
title: 계정 정보 기반 공격_2
parent: Vulnerability Exploitation
nav_order: 2
---

# 계정 정보 기반 공격-2

---

## Hydra
브루트 포스, 사전 공격에 많이 사용되는 툴이다.\
`Hydra`는 SSH, FTP, HTTP 외에도 다양한 종류의 프로토콜 및 네트워크 서비스들을 상대로 브루트포스 공격을 할 수 있다.

---

## Hydra를 이용한 사전 공격

- ssh 사전 공격
> hydra -L <users.txt> -P <pass.txt> ssh://<ip> -V -s <포트>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lArr; 다수의 유저를 상대로<br>
> hydra -l <유저이름> -P <pass.txt> ssh://<ip> -V -s <포트> -f &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lArr; 한 명의 유저를 상대로
>> -f 옵션은 hydra를 중지할 때 쓰는 옵션

- ftp 사전 공격
> hydra -L <users.txt> -P <pass.txt> ftp://<ip> -s <port> -V -s <port>

미리 만들어둔 users.txt 파일과 rockyou.txt를 이용해 만든 pass.txt 파일로 공격을 진행

![ssh사전공격](\assets\images\acco1_ssh사전공격.png)
ssh 사전공격
{: .text-center}
![ssh사전공격2](\assets\images\acco2_ssh사전공격2.png)
ssh 사전공격2
{: .text-center}
![ssh사전공격3](\assets\images\acco3_ssh사전공격3.png)
ssh 사전공격3
{: .text-center}


hydra를 통해 계정명과 비밀번호를 얻어냈고 실제로 ssh로그인이 가능했다.


![ftp사전공격](\assets\images\acco4_ftp사전공격.png)
ftp 사전공격
{: .text-center}

![ftp사전공격2](\assets\images\acco5_ftp사전공격2.png)
ftp 사전공격2
{: .text-center}

ftp도 같은 방식으로 가능했다. 다만 공격 진행했던 머신은 ftp 익명 로그인이 가능했던 상태였기 때문에 anonymous 계정명으로 모든 비밀번호가 성공했다.

---

## HTTP를 대상으로 한 hydra 사전 공격

hydra를 통해 http 브루트포스를 진행할 때는 다음과 같은 정보들을 먼저 확인한 뒤 hydra를 실행해야 한다.

1. 로그인이 이루어지는 URL
2. 로그인이 이루어질 때 사용되는 HTTP 요청의 종류(GET, POST)
3. 사용자 이름과 비밀번호를 전송하는 파라미터 이름
4. 로그인 실패 시 나오는 에러 메시지

![burpsuite정보수집](\assets\images\acco6_burpsuite정보수집.png)
burpsuite intercept 기능을 이용한 정보수집
{: .text-center}

![에러메시지](\assets\images\acco7_에러메시지.png){: style="width: 400px; height: auto;"}
{: .text-center}
에러메시지
{: .text-center}

burpsuite를 이용해 아래의 정보들을 수집했다.

| 항목       | 내용                                    |
|------------|-----------------------------------------|
| **주소**   | 172.31.246.60:8081/wp-login.php         |
| **요청방식** | POST                                   |
| **파라미터** | log, pwd                               |
| **에러 메시지** | ERROR: Invalid username             |

> 워드 프레스 에러 메시지는
>> 유저 이름이 틀렸을 경우 &rarr; Invalid username<br><br>
>> 유저 이름은 맞았지만 패스워드가 틀렸을 경우<br>&rarr; The password you entered for the username <유저이름> is incorrect.<br>

이러한 워드프레스 특성을 이용해 유저 이름을 먼저 브루트포스 해서 알아낸 뒤, 알아낸 유저 이름을 통해 패스워드 브루트포스를 하면 된다.

---

## 유저 이름 브루트포스

<br>

``` hydra -L users.txt -p <임의의비밀번호> 172.31.246.60 -s 8081 http-post-form "/wp-login.php:log=^USER^&pwd=^PASS^:F=Invalid" -V```
{: .fs-6 .text-center}

해당 로그인 페이지에 users.txt 파일과 임의의 비밀번호 `asdf` 를 조합해서 HTTP POST 요청을<br>log, pwd 파라미터에 넣어 보내고 응답에 `Invalid` 라는 문자열이 포함된 경우 실패로 간주하는
명령어를 작성한다.

![wordpress유저명획득](\assets\images\acco8_wordpress유저명획득.png)
wordpress 유저명 획득
{: .text-center}

알아낸 유저이름으로 wordpress_users.txt 명으로 된 파일을 생성한다.

이제 유저 이름을 알아냈으니 유저 이름은 맞고 패스워드가 틀렸을 때 위의 에러메시지를 반환하는지 확인한다.

![에러메시지확인](\assets\images\acco9_에러메시지확인.png){: style="width: 400px; height: auto;"}
{: .text-center}
에러 메시지 확인
{: .text-center}

users.txt 자리에 앞서 확인된 계정 이름을 나열해둔 파일인 wordpress_users.txt 파일을 넣고 Invalid 에러메시지 자리에 incorrect를 넣고 실행했다.

![pw사전파일공격](\assets\images\acco10_pw사전파일공격.png)
비밀번호 사전파일 공격
{: .text-center}

![pw획득](\assets\images\acco11_pw획득.png)
비밀번호 획득
{: .text-center}

![로그인 성공](\assets\images\acco12_로그인성공.png)
로그인 성공
{: .text-center}

---

## WPSCAN을 활용한 워드프레스 사전 공격
<br>
위처럼 **hydra**를 이용해 계정이름 사전 공격을 하고 패스워드도 사전 공격하는 방법이 있지만 **wpscan** 을 이용한 더 간편한 방법이 있다.

**wpscan**이라는 툴을 사용하면 계정 이름을 찾은 뒤 자동으로 패스워드 사전 공격도 진행한다.

``` wpscan --url <url주소:포트> --passwords <패스워드 사전파일> ```
{: .fs-6 .text-center}

![wpscan 이용](\assets\images\acco13_wpscan.png){: style="width: 600px; height: auto;"}
{: .text-center}
wpscan을 이용한 공격
{: .text-center}

![wpscan 이용2](\assets\images\acco14_wpscan2.png){: style="width: 600px; height: auto;"}
{: .text-center}
wpscan을 이용한 공격2
{: .text-center}

hydra로 얻은 계정 정보와 동일한 계정이 나왔다.

---

## 패스워드 스프레이 공격
<br>

``` hydra -L <계정이름 사전파일> -p '공격하고 싶은 패스워드' ssh://<ip> -V ```
{: .fs-6 .text-center}

기본 개념은 똑같고 -p 옵션에 뿌리고 싶은 패스워드를 넣어주면 된다.